name: Website Monitor with Daily Status

on:
  schedule:
    - cron: '*/5 * * * *'   # Every 5 minutes
    - cron: '0 9 * * *'     # Daily at 9 AM
  workflow_dispatch:

jobs:
  monitor:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repo
      uses: actions/checkout@v4

    - name: Ping website
      env:
        URL: https://telegramforwarder-5gl5.onrender.com
        TG_BOT_TOKEN: ${{ secrets.TG_BOT_TOKEN }}
        TG_CHAT_ID: ${{ secrets.TG_CHAT_ID }}
      run: |
        echo "üîÑ Pinging website..."
        HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" --max-time 30 "$URL")
        echo "Status: $HTTP_CODE"
        
        # Check if it's 9 AM for daily report
        CURRENT_HOUR=$(date +%H)
        CURRENT_MIN=$(date +%M)
        
        if [ "$CURRENT_HOUR" = "09" ] && [ "$CURRENT_MIN" = "00" ]; then
          echo "üìÖ Sending daily report..."
          curl -s -X POST "https://api.telegram.org/bot$TG_BOT_TOKEN/sendMessage" \
            -d chat_id="$TG_CHAT_ID" \
            -d text="ü§ñ Daily Report: Your bot is working perfectly! ‚úÖ Time: $(date)"
        fi
        
        if [ "$HTTP_CODE" -eq 200 ]; then
          echo "‚úÖ Website is UP"
        else
          echo "‚ùå Website is DOWN"
          exit 1
        fi
